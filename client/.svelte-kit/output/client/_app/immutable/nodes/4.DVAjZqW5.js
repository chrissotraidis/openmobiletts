import{c as Ae,a as R,f as N}from"../chunks/BFfIV2Jx.js";import{w as et,o as Ne,a as pt}from"../chunks/e1lkKKbt.js";import{o as K,x as Be,a1 as gt,D as Pe,q as mt,n as ht,g as i,v as bt,H as _t,w as Xe,y as Ie,G as Te,ab as yt,aD as xt,an as Je,z as ke,F as Ce,J as wt,aO as St,aT as tt,aB as He,aU as Tt,aa as We,aV as kt,aW as At,O as Dt,aX as ee,A as at,C as rt,aY as Re,aZ as $t,aA as Et,B as Ut,M as Lt,ax as Mt,a_ as nt,a$ as Bt,Y as Pt,K as It,_ as Rt,b0 as Ct,b1 as Ft,P as Ot,p as be,f as ot,s as I,R as De,a as _e,c as V,b as g,d as x,r as b,t as te,b2 as Nt,aI as Ht}from"../chunks/CTMsHKgE.js";import{d as $e,s as X,e as ue}from"../chunks/BKQy3XBz.js";import{i as Z}from"../chunks/DeM2r7LR.js";import{s as Fe,r as zt,b as Ye,a as it}from"../chunks/CbIFq4Pm.js";import{g as Ke}from"../chunks/ByCQATkF.js";import{s as he,a as Ee,b as qt}from"../chunks/Dwg5tGCH.js";import"../chunks/C8QOig4c.js";import{i as jt}from"../chunks/CmwpFfrH.js";const Gt=!0;function Vt(e,o){return o}function Xt(e,o,t){for(var r=[],s=o.length,a,n=o.length,u=0;u<s;u++){let k=o[u];rt(k,()=>{if(a){if(a.pending.delete(k),a.done.add(k),a.pending.size===0){var T=e.outrogroups;Oe(He(a.done)),T.delete(a),T.size===0&&(e.outrogroups=null)}}else n-=1},!1)}if(n===0){var d=r.length===0&&t!==null;if(d){var f=t,c=f.parentNode;Et(c),c.append(f),e.items.clear()}Oe(o,!d)}else a={pending:new Set(o),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(a)}function Oe(e,o=!0){for(var t=0;t<e.length;t++)Ut(e[t],o)}var Ze;function st(e,o,t,r,s,a=null){var n=e,u=new Map,d=(o&nt)!==0;if(d){var f=e;n=K?Be(gt(f)):f.appendChild(Pe())}K&&mt();var c=null,k=St(()=>{var m=t();return tt(m)?m:m==null?[]:He(m)}),T,A=!0;function P(){l.fallback=c,Jt(l,T,n,o,r),c!==null&&(T.length===0?(c.f&ee)===0?at(c):(c.f^=ee,ge(c,null,n)):rt(c,()=>{c=null}))}var E=ht(()=>{T=i(k);var m=T.length;let F=!1;if(K){var H=bt(n)===_t;H!==(m===0)&&(n=Xe(),Be(n),Ie(!1),F=!0)}for(var p=new Set,w=ke,M=wt(),v=0;v<m;v+=1){K&&Te.nodeType===yt&&Te.data===xt&&(n=Te,F=!0,Ie(!1));var _=T[v],h=r(_,v),y=A?null:u.get(h);y?(y.v&&Je(y.v,_),y.i&&Je(y.i,v),M&&w.skipped_effects.delete(y.e)):(y=Wt(u,A?n:Ze??(Ze=Pe()),_,h,v,s,o,t),A||(y.e.f|=ee),u.set(h,y)),p.add(h)}if(m===0&&a&&!c&&(A?c=Ce(()=>a(n)):(c=Ce(()=>a(Ze??(Ze=Pe()))),c.f|=ee)),K&&m>0&&Be(Xe()),!A)if(M){for(const[C,O]of u)p.has(C)||w.skipped_effects.add(O.e);w.oncommit(P),w.ondiscard(()=>{})}else P();F&&Ie(!0),i(k)}),l={effect:E,items:u,outrogroups:null,fallback:c};A=!1,K&&(n=Te)}function pe(e){for(;e!==null&&(e.f&$t)===0;)e=e.next;return e}function Jt(e,o,t,r,s){var y,C,O,j,J,Y,G,ae,W;var a=(r&Bt)!==0,n=o.length,u=e.items,d=pe(e.effect.first),f,c=null,k,T=[],A=[],P,E,l,m;if(a)for(m=0;m<n;m+=1)P=o[m],E=s(P,m),l=u.get(E).e,(l.f&ee)===0&&((C=(y=l.nodes)==null?void 0:y.a)==null||C.measure(),(k??(k=new Set)).add(l));for(m=0;m<n;m+=1){if(P=o[m],E=s(P,m),l=u.get(E).e,e.outrogroups!==null)for(const B of e.outrogroups)B.pending.delete(l),B.done.delete(l);if((l.f&ee)!==0)if(l.f^=ee,l===d)ge(l,null,t);else{var F=c?c.next:d;l===e.effect.last&&(e.effect.last=l.prev),l.prev&&(l.prev.next=l.next),l.next&&(l.next.prev=l.prev),ie(e,c,l),ie(e,l,F),ge(l,F,t),c=l,T=[],A=[],d=pe(c.next);continue}if((l.f&Re)!==0&&(at(l),a&&((j=(O=l.nodes)==null?void 0:O.a)==null||j.unfix(),(k??(k=new Set)).delete(l))),l!==d){if(f!==void 0&&f.has(l)){if(T.length<A.length){var H=A[0],p;c=H.prev;var w=T[0],M=T[T.length-1];for(p=0;p<T.length;p+=1)ge(T[p],H,t);for(p=0;p<A.length;p+=1)f.delete(A[p]);ie(e,w.prev,M.next),ie(e,c,w),ie(e,M,H),d=H,c=M,m-=1,T=[],A=[]}else f.delete(l),ge(l,d,t),ie(e,l.prev,l.next),ie(e,l,c===null?e.effect.first:c.next),ie(e,c,l),c=l;continue}for(T=[],A=[];d!==null&&d!==l;)(f??(f=new Set)).add(d),A.push(d),d=pe(d.next);if(d===null)continue}(l.f&ee)===0&&T.push(l),c=l,d=pe(l.next)}if(e.outrogroups!==null){for(const B of e.outrogroups)B.pending.size===0&&(Oe(He(B.done)),(J=e.outrogroups)==null||J.delete(B));e.outrogroups.size===0&&(e.outrogroups=null)}if(d!==null||f!==void 0){var v=[];if(f!==void 0)for(l of f)(l.f&Re)===0&&v.push(l);for(;d!==null;)(d.f&Re)===0&&d!==e.fallback&&v.push(d),d=pe(d.next);var _=v.length;if(_>0){var h=(r&nt)!==0&&n===0?t:null;if(a){for(m=0;m<_;m+=1)(G=(Y=v[m].nodes)==null?void 0:Y.a)==null||G.measure();for(m=0;m<_;m+=1)(W=(ae=v[m].nodes)==null?void 0:ae.a)==null||W.fix()}Xt(e,v,h)}}a&&Lt(()=>{var B,Q;if(k!==void 0)for(l of k)(Q=(B=l.nodes)==null?void 0:B.a)==null||Q.apply()})}function Wt(e,o,t,r,s,a,n,u){var d=(n&kt)!==0?(n&At)===0?Dt(t,!1,!1):We(t):null,f=(n&Tt)!==0?We(s):null;return{v:d,i:f,e:Ce(()=>(a(o,d??t,f??s,u),()=>{e.delete(r)}))}}function ge(e,o,t){if(e.nodes)for(var r=e.nodes.start,s=e.nodes.end,a=o&&(o.f&ee)===0?o.nodes.start:t;r!==null;){var n=Mt(r);if(a.before(r),r===s)return;r=n}}function ie(e,o,t){o===null?e.effect.first=t:o.next=t,t===null?e.effect.last=o:t.prev=o}const Qe=[...` 	
\r\f¬†\v\uFEFF`];function Yt(e,o,t){var r=""+e;if(t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var a=s.length,n=0;(n=r.indexOf(s,n))>=0;){var u=n+a;(n===0||Qe.includes(r[n-1]))&&(u===r.length||Qe.includes(r[u]))?r=(n===0?"":r.substring(0,n))+r.substring(u+1):n=u}}return r===""?null:r}function Kt(e,o){return e==null?null:String(e)}function Zt(e,o,t,r,s,a){var n=e.__className;if(K||n!==t||n===void 0){var u=Yt(t,r,a);(!K||u!==e.getAttribute("class"))&&(u==null?e.removeAttribute("class"):e.className=u),e.__className=t}else if(a&&s!==a)for(var d in a){var f=!!a[d];(s==null||f!==!!s[d])&&e.classList.toggle(d,f)}return a}function Qt(e,o,t,r){var s=e.__style;if(K||s!==o){var a=Kt(o);(!K||a!==e.getAttribute("style"))&&(a==null?e.removeAttribute("style"):e.style.cssText=a),e.__style=o}return r}function lt(e,o,t=!1){if(e.multiple){if(o==null)return;if(!tt(o))return Ct();for(var r of e.options)r.selected=o.includes(me(r));return}for(r of e.options){var s=me(r);if(Ft(s,o)){r.selected=!0;return}}(!t||o!==void 0)&&(e.selectedIndex=-1)}function ea(e){var o=new MutationObserver(()=>{lt(e,e.__value)});o.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ot(()=>{o.disconnect()})}function ta(e,o,t=o){var r=new WeakSet,s=!0;Pt(e,"change",a=>{var n=a?"[selected]":":checked",u;if(e.multiple)u=[].map.call(e.querySelectorAll(n),me);else{var d=e.querySelector(n)??e.querySelector("option:not([disabled])");u=d&&me(d)}t(u),ke!==null&&r.add(ke)}),It(()=>{var a=o();if(e===document.activeElement){var n=Rt??ke;if(r.has(n))return}if(lt(e,a,s),s&&a===void 0){var u=e.querySelector(":checked");u!==null&&(a=me(u),t(a))}e.__value=a,s=!1}),ea(e)}function me(e){return"__value"in e?e.__value:e.value}const aa=Gt;function ra(){const{subscribe:e,set:o,update:t}=et({text:"",timingData:[],audioUrl:null,audioBlob:null,isPlaying:!1,isLoading:!1,currentTime:0,duration:0,error:null});return{subscribe:e,setText:r=>t(s=>({...s,text:r})),setTimingData:r=>t(s=>({...s,timingData:r})),setAudioUrl:r=>t(s=>({...s,audioUrl:r})),setAudioBlob:r=>t(s=>({...s,audioBlob:r})),setPlaying:r=>t(s=>({...s,isPlaying:r})),setLoading:r=>t(s=>({...s,isLoading:r})),setCurrentTime:r=>t(s=>({...s,currentTime:r})),setDuration:r=>t(s=>({...s,duration:r})),setError:r=>t(s=>({...s,error:r})),reset:()=>o({text:"",timingData:[],audioUrl:null,audioBlob:null,isPlaying:!1,isLoading:!1,currentTime:0,duration:0,error:null})}}const $=ra();var na=N('<button class="btn btn-primary">‚è∏Ô∏è Pause</button>'),oa=N('<button class="btn btn-primary">‚ñ∂Ô∏è Play</button>'),ia=N('<button class="btn btn-secondary w-full"> </button>'),sa=N('<div class="bg-white rounded-xl shadow-lg p-6 space-y-4 sticky bottom-0"><h3 class="text-lg font-semibold text-gray-900">Audio Player</h3> <audio preload="auto" controls></audio> <div class="space-y-2"><div class="relative h-2 bg-gray-200 rounded-full cursor-pointer" role="progressbar" tabindex="0" aria-valuemin="0"><div class="absolute h-full bg-primary-600 rounded-full"></div></div> <div class="flex justify-between text-sm text-gray-600"><span> </span> <span> </span></div></div> <div class="flex items-center justify-center gap-4"><button class="btn btn-secondary">‚è™ 10s</button> <!> <button class="btn btn-secondary">10s ‚è©</button></div> <!></div>');function la(e,o){be(o,!0);const t=()=>he($,"$playerStore",r),[r,s]=Ee();let a=V(null),n=V(-1),u=V(null),d=V(!1);ot(()=>{i(a)&&t().audioUrl&&t().audioUrl!==i(u)&&(console.log("Setting audio src:",t().audioUrl),I(u,t().audioUrl,!0),I(d,!0),i(a).src=t().audioUrl,i(a).load())});function f(){var v;(v=i(a))==null||v.play(),$.setPlaying(!0)}function c(){var v;(v=i(a))==null||v.pause(),$.setPlaying(!1)}let k=V(0);function T(){if(!i(a))return;const v=i(a).currentTime,_=Date.now();if(_-i(k)<250||(I(k,_,!0),$.setCurrentTime(v),t().timingData.length===0))return;const h=t().timingData.findIndex(y=>v>=y.start&&v<y.end);if(h!==i(n)&&(I(n,h,!0),h>=0)){const y=document.getElementById(`segment-${h}`);y==null||y.scrollIntoView({behavior:"smooth",block:"center"})}}function A(){i(a)&&$.setDuration(i(a).duration)}function P(){$.setPlaying(!1)}function E(v){var _,h,y;console.error("Audio error:",v,(_=i(a))==null?void 0:_.error),$.setError(`Audio playback error: ${((y=(h=i(a))==null?void 0:h.error)==null?void 0:y.message)||"Unknown error"}`)}function l(){var v;console.log("Audio can play - duration:",(v=i(a))==null?void 0:v.duration),i(d)&&t().isPlaying?(I(d,!1),console.log("Auto-playing newly loaded audio"),i(a).play().catch(_=>{console.warn("Auto-play failed:",_),$.setPlaying(!1)})):I(d,!1)}function m(v){const _=Math.floor(v/60),h=Math.floor(v%60);return`${_}:${h.toString().padStart(2,"0")}`}function F(v){if(!i(a))return;const _=v.currentTarget.getBoundingClientRect(),h=(v.clientX-_.left)/_.width;i(a).currentTime=h*i(a).duration}function H(){if(!t().audioBlob){console.error("No audio blob available for download");return}console.log("Downloading audio blob:",{size:t().audioBlob.size,type:t().audioBlob.type,duration:t().duration});const v=URL.createObjectURL(t().audioBlob),_=document.createElement("a");_.href=v,_.download=`tts-audio-${Date.now()}.mp3`,document.body.appendChild(_),_.click(),document.body.removeChild(_),setTimeout(()=>{URL.revokeObjectURL(v)},6e4)}Ne(()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:"TTS Playback",artist:"Open Mobile TTS",album:"Generated Speech"}),navigator.mediaSession.setActionHandler("play",f),navigator.mediaSession.setActionHandler("pause",c),navigator.mediaSession.setActionHandler("seekbackward",()=>{i(a)&&(i(a).currentTime=Math.max(i(a).currentTime-10,0))}),navigator.mediaSession.setActionHandler("seekforward",()=>{i(a)&&(i(a).currentTime=Math.min(i(a).currentTime+10,i(a).duration))}))}),pt(()=>{});var p=Ae(),w=De(p);{var M=v=>{var _=sa(),h=g(x(_),2);qt(h,D=>I(a,D),()=>i(a));var y=g(h,2),C=x(y);C.__click=F;var O=x(C);b(C);var j=g(C,2),J=x(j),Y=x(J,!0);b(J);var G=g(J,2),ae=x(G,!0);b(G),b(j),b(y);var W=g(y,2),B=x(W);B.__click=()=>{i(a)&&(i(a).currentTime-=10)};var Q=g(B,2);{var re=D=>{var S=na();S.__click=c,R(D,S)},ce=D=>{var S=oa();S.__click=f,te(()=>S.disabled=!t().audioUrl),R(D,S)};Z(Q,D=>{t().isPlaying?D(re):D(ce,!1)})}var le=g(Q,2);le.__click=()=>{i(a)&&(i(a).currentTime+=10)},b(W);var fe=g(W,2);{var U=D=>{var S=ia();S.__click=H;var z=x(S);b(S),te(L=>X(z,`‚¨áÔ∏è Download MP3 (${L??""})`),[()=>m(t().duration)]),R(D,S)};Z(fe,D=>{t().audioUrl&&D(U)})}b(_),te((D,S)=>{Fe(C,"aria-valuenow",t().currentTime),Fe(C,"aria-valuemax",t().duration),Qt(O,`width: ${t().currentTime/t().duration*100||0}%`),X(Y,D),X(ae,S),B.disabled=!t().audioUrl,le.disabled=!t().audioUrl},[()=>m(t().currentTime),()=>m(t().duration)]),ue("play",h,f),ue("pause",h,c),ue("timeupdate",h,T),ue("loadedmetadata",h,A),ue("ended",h,P),ue("error",h,E),ue("canplay",h,l),R(v,_)};Z(w,v=>{t().audioUrl&&v(M)})}R(e,p),_e(),s()}$e(["click"]);function da(){const{subscribe:e,update:o}=et({lastUpdated:Date.now()});return{subscribe:e,notifyUpdate:()=>{o(t=>({...t,lastUpdated:Date.now()}))}}}const dt=da(),ut="http://localhost:8000";async function ua(e,o,t,r){const s=new URLSearchParams({text:e,voice:o||"af_heart",speed:(t==null?void 0:t.toString())||"1.0"}),a=await fetch(`${ut}/api/tts/stream?${s}`,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Failed to generate speech");return a}async function ca(e,o){const t=new FormData;t.append("file",e);const r=await fetch(`${ut}/api/documents/upload`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:t});if(!r.ok)throw new Error("Failed to upload document");return r.json()}const fa="openmobiletts",se="audioCache",va=1;function ze(){return new Promise((e,o)=>{const t=indexedDB.open(fa,va);t.onerror=()=>o(t.error),t.onsuccess=()=>e(t.result),t.onupgradeneeded=r=>{const s=r.target.result;if(!s.objectStoreNames.contains(se)){const a=s.createObjectStore(se,{keyPath:"id",autoIncrement:!0});a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("text","text",{unique:!1})}}})}async function pa(e,o,t,r,s){const a=await ze(),n={text:e,audioBlob:o,timingData:t,voice:r,speed:s,timestamp:Date.now()};return new Promise((u,d)=>{const k=a.transaction([se],"readwrite").objectStore(se).add(n);k.onsuccess=()=>u(k.result),k.onerror=()=>d(k.error)})}async function ga(){const e=await ze();return new Promise((o,t)=>{const a=e.transaction([se],"readonly").objectStore(se).getAll();a.onsuccess=()=>{const n=a.result||[];n.sort((u,d)=>d.timestamp-u.timestamp),o(n)},a.onerror=()=>t(a.error)})}async function ma(e){const o=await ze();return new Promise((t,r)=>{const n=o.transaction([se],"readwrite").objectStore(se).delete(e);n.onsuccess=()=>t(),n.onerror=()=>r(n.error)})}var ha=N('<div class="bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg text-center"><div class="flex items-center justify-center gap-2"><div class="animate-spin h-4 w-4 border-2 border-blue-700 border-t-transparent rounded-full"></div> <span> </span></div></div>'),ba=N('<div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg"> </div>'),_a=N(`<div class="bg-white rounded-xl shadow-lg p-6 space-y-6"><h2 class="text-xl font-semibold text-gray-900">Generate Speech</h2> <div><label for="text" class="block text-sm font-medium text-gray-700 mb-2">Enter Text or Upload Document</label> <textarea id="text" rows="6" class="input resize-none" placeholder="Type or paste text here..."></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-2">Upload Document (PDF, DOCX, TXT)</label> <input type="file" accept=".pdf,.docx,.txt" class="block w-full text-sm text-gray-500
				file:mr-4 file:py-2 file:px-4
				file:rounded-lg file:border-0
				file:text-sm file:font-semibold
				file:bg-primary-50 file:text-primary-700
				hover:file:bg-primary-100
				file:cursor-pointer cursor-pointer"/></div> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="voice" class="block text-sm font-medium text-gray-700 mb-2">Voice</label> <select id="voice" class="input"><option>Female (Heart)</option><option>Female (Nova)</option><option>Female (Sky)</option><option>Female (Bella)</option><option>Female (Sarah)</option><option>Male (Adam)</option><option>Male (Michael)</option><option>British Female (Emma)</option><option>British Female (Isabella)</option><option>British Male (George)</option><option>British Male (Lewis)</option></select></div> <div><label for="speed" class="block text-sm font-medium text-gray-700 mb-2"> </label> <input id="speed" type="range" min="0.5" max="2.0" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"/></div></div> <button class="btn btn-primary w-full"> </button> <!> <!></div>`);function ya(e,o){be(o,!0);const t=()=>he(it,"$authStore",s),r=()=>he($,"$playerStore",s),[s,a]=Ee();let n=V(""),u=V("af_heart"),d=V(1),f=V("");async function c(){if(!i(n).trim()){$.setError("Please enter some text");return}$.setLoading(!0),$.setError(null),$.setText(i(n)),I(f,"Starting generation...");try{const U=await ua(i(n),i(u),i(d),t().token);I(f,"Receiving audio stream...");const D=U.body.getReader(),S=[],z=[];let L=new Uint8Array(0),Ue=!1,ye=0;for(console.log("Starting to read stream...");;){ye++;const{done:ne,value:de}=await D.read();if(ne){Ue=!0,console.log(`Stream complete after ${ye} iterations`),I(f,"Finalizing audio..."),L.length>0&&(S.push(L),L=new Uint8Array(0));break}ye%10===0&&console.log(`Iteration ${ye}: received ${de==null?void 0:de.length} bytes`);const ft=S.reduce((oe,je)=>oe+je.length,0);I(f,`Received ${Math.round(ft/1024)}KB, ${z.length} segments...`);const Le=new Uint8Array(L.length+de.length);for(Le.set(L),Le.set(de,L.length),L=Le;;){let oe=-1;const Me=new TextEncoder().encode("TIMING:");for(let q=0;q<=L.length-Me.length;q++){let Ve=!0;for(let Se=0;Se<Me.length;Se++)if(L[q+Se]!==Me[Se]){Ve=!1;break}if(Ve){oe=q;break}}if(oe===-1){L.length>0&&(S.push(L),L=new Uint8Array(0));break}if(oe>0){const q=L.slice(0,oe);S.push(q)}let we=-1;for(let q=oe;q<L.length;q++)if(L[q]===10){we=q;break}if(we===-1)break;const vt=L.slice(oe,we),Ge=new TextDecoder().decode(vt).slice(7);try{const q=JSON.parse(Ge);z.push(q)}catch{console.warn("Failed to parse timing:",Ge)}L=L.slice(we+1)}}if(S.length===0)throw new Error("No audio data received from server");const ve=new Blob(S,{type:"audio/mpeg"}),xe=S.reduce((ne,de)=>ne+de.length,0);console.log("Created audio blob:",{size:ve.size,type:ve.type,chunks:S.length,timingData:z.length,totalBytes:xe,averageChunkSize:Math.round(xe/S.length)});const ct=i(n).length*.1;xe<ct&&console.warn(`Audio seems small (${xe} bytes) for text length (${i(n).length} chars). May be incomplete.`);const qe=URL.createObjectURL(ve);console.log("Created blob URL:",qe),$.setAudioBlob(ve),$.setAudioUrl(qe),$.setTimingData(z);try{console.log("Saving audio to cache...",{text:i(n).substring(0,50),voice:i(u),speed:i(d)});const ne=await pa(i(n),ve,z,i(u),i(d));console.log("Audio saved to cache with ID:",ne),dt.notifyUpdate()}catch(ne){console.error("Failed to cache audio:",ne),$.setError("Warning: Failed to save to history - "+ne.message)}}catch(U){$.setError(U.message||"Failed to generate speech"),I(f,"")}finally{$.setLoading(!1),I(f,"")}}async function k(U){var S;const D=(S=U.target.files)==null?void 0:S[0];if(D){$.setLoading(!0),$.setError(null);try{const z=await ca(D,t().token);I(n,z.text,!0)}catch(z){$.setError(z.message||"Failed to upload document")}finally{$.setLoading(!1)}}}var T=_a(),A=g(x(T),2),P=g(x(A),2);Nt(P),b(A);var E=g(A,2),l=g(x(E),2);l.__change=k,b(E);var m=g(E,2),F=x(m),H=g(x(F),2),p=x(H);p.value=p.__value="af_heart";var w=g(p);w.value=w.__value="af_nova";var M=g(w);M.value=M.__value="af_sky";var v=g(M);v.value=v.__value="af_bella";var _=g(v);_.value=_.__value="af_sarah";var h=g(_);h.value=h.__value="am_adam";var y=g(h);y.value=y.__value="am_michael";var C=g(y);C.value=C.__value="bf_emma";var O=g(C);O.value=O.__value="bf_isabella";var j=g(O);j.value=j.__value="bm_george";var J=g(j);J.value=J.__value="bm_lewis",b(H),b(F);var Y=g(F,2),G=x(Y),ae=x(G);b(G);var W=g(G,2);zt(W),b(Y),b(m);var B=g(m,2);B.__click=c;var Q=x(B,!0);b(B);var re=g(B,2);{var ce=U=>{var D=ha(),S=x(D),z=g(x(S),2),L=x(z,!0);b(z),b(S),b(D),te(()=>X(L,i(f))),R(U,D)};Z(re,U=>{i(f)&&U(ce)})}var le=g(re,2);{var fe=U=>{var D=ba(),S=x(D,!0);b(D),te(()=>X(S,r().error)),R(U,D)};Z(le,U=>{r().error&&U(fe)})}b(T),te(U=>{X(ae,`Speed: ${i(d)??""}x`),B.disabled=U,X(Q,r().isLoading?"Generating...":"Generate Speech")},[()=>r().isLoading||!i(n).trim()]),Ye(P,()=>i(n),U=>I(n,U)),ta(H,()=>i(u),U=>I(u,U)),Ye(W,()=>i(d),U=>I(d,U)),R(e,T),_e(),a()}$e(["change","click"]);var xa=N("<span> </span>"),wa=N('<div class="bg-white rounded-xl shadow-lg p-6"><h3 class="text-lg font-semibold text-gray-900 mb-4">Text (Synchronized)</h3> <div class="prose max-w-none"></div></div>');function Sa(e,o){be(o,!1);const t=()=>he($,"$playerStore",r),[r,s]=Ee();function a(f,c){return c>=f.start&&c<f.end}jt();var n=Ae(),u=De(n);{var d=f=>{var c=wa(),k=g(x(c),2);st(k,5,()=>t().timingData,Vt,(T,A,P)=>{var E=xa();Fe(E,"id",`segment-${P}`);let l;var m=x(E);b(E),te(F=>{l=Zt(E,1,"text-segment",null,l,F),X(m,`${i(A).text??""} `)},[()=>({highlighted:a(i(A),t().currentTime)})]),R(T,E)}),b(k),b(c),R(f,c)};Z(u,f=>{t().text&&t().timingData.length>0&&f(d)})}R(e,n),_e(),s()}var Ta=N('<div class="text-center py-8 text-gray-500">Loading history...</div>'),ka=N('<div class="text-center py-8 text-gray-500">No saved audio yet. Generate some speech to see it here!</div>'),Aa=N('<div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"><div class="flex items-start justify-between gap-3"><div class="flex-1 min-w-0"><p class="text-sm text-gray-900 mb-1"> </p> <div class="flex items-center gap-3 text-xs text-gray-500"><span> </span> <span>‚Ä¢</span> <span> </span> <span>‚Ä¢</span> <span> </span></div></div> <div class="flex gap-2"><button class="px-3 py-1 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700" title="Play this audio">‚ñ∂Ô∏è</button> <button class="px-3 py-1 bg-green-50 text-green-700 text-sm rounded-lg hover:bg-green-100" title="Download MP3">‚¨áÔ∏è</button> <button class="px-3 py-1 bg-red-50 text-red-600 text-sm rounded-lg hover:bg-red-100" title="Delete this audio">üóëÔ∏è</button></div></div></div>'),Da=N('<div class="space-y-3 max-h-96 overflow-y-auto"></div>'),$a=N('<div class="bg-white rounded-xl shadow-lg p-6 space-y-4"><div class="flex justify-between items-center"><h3 class="text-lg font-semibold text-gray-900">History</h3> <button class="text-sm text-primary-600 hover:text-primary-700"> </button></div> <!></div>');function Ea(e,o){be(o,!0);const t=()=>he(dt,"$historyStore",r),[r,s]=Ee();let a=V(Ht([])),n=V(!1);Ne(async()=>{await u()}),ot(()=>{t().lastUpdated&&aa&&u()});async function u(){I(n,!0);try{console.log("Loading history from IndexedDB..."),I(a,await ga(),!0),console.log("Loaded history:",i(a).length,"items")}catch(p){console.error("Failed to load history:",p)}finally{I(n,!1)}}async function d(p){const w=URL.createObjectURL(p.audioBlob);$.setAudioBlob(p.audioBlob),$.setAudioUrl(w),$.setTimingData(p.timingData),$.setText(p.text),setTimeout(()=>{$.setPlaying(!0)},100)}async function f(p){if(confirm("Delete this audio?"))try{await ma(p),await u()}catch(w){console.error("Failed to delete:",w)}}function c(p){const w=new Date(p),v=new Date-w,_=Math.floor(v/6e4),h=Math.floor(v/36e5),y=Math.floor(v/864e5);return _<1?"Just now":_<60?`${_}m ago`:h<24?`${h}h ago`:y<7?`${y}d ago`:w.toLocaleDateString()}function k(p,w=60){return p.length<=w?p:p.slice(0,w)+"..."}function T(p){const w=URL.createObjectURL(p.audioBlob),M=document.createElement("a");M.href=w,M.download=`tts-${p.voice}-${p.timestamp}.mp3`,document.body.appendChild(M),M.click(),document.body.removeChild(M),setTimeout(()=>URL.revokeObjectURL(w),6e4)}var A=$a(),P=x(A),E=g(x(P),2);E.__click=u;var l=x(E,!0);b(E),b(P);var m=g(P,2);{var F=p=>{var w=Ta();R(p,w)},H=p=>{var w=Ae(),M=De(w);{var v=h=>{var y=ka();R(h,y)},_=h=>{var y=Da();st(y,21,()=>i(a),C=>C.id,(C,O)=>{var j=Aa(),J=x(j),Y=x(J),G=x(Y),ae=x(G,!0);b(G);var W=g(G,2),B=x(W),Q=x(B,!0);b(B);var re=g(B,4),ce=x(re,!0);b(re);var le=g(re,4),fe=x(le);b(le),b(W),b(Y);var U=g(Y,2),D=x(U);D.__click=()=>d(i(O));var S=g(D,2);S.__click=()=>T(i(O));var z=g(S,2);z.__click=()=>f(i(O).id),b(U),b(J),b(j),te((L,Ue)=>{X(ae,L),X(Q,Ue),X(ce,i(O).voice),X(fe,`${i(O).speed??""}x`)},[()=>k(i(O).text),()=>c(i(O).timestamp)]),R(C,j)}),b(y),R(h,y)};Z(M,h=>{i(a).length===0?h(v):h(_,!1)},!0)}R(p,w)};Z(m,p=>{i(n)?p(F):p(H,!1)})}b(A),te(()=>{E.disabled=i(n),X(l,i(n)?"Loading...":"üîÑ Refresh")}),R(e,A),_e(),s()}$e(["click"]);var Ua=N(`<div class="bg-yellow-50 border-t border-yellow-200 p-4"><p class="text-sm text-yellow-800 text-center">üì± iOS Limitation: Audio will stop when app is minimized or screen locks.
					Keep app in foreground during playback.</p></div>`),La=N('<div class="min-h-screen flex flex-col"><header class="bg-white shadow-sm border-b border-gray-200"><div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center"><h1 class="text-2xl font-bold text-primary-600">Open Mobile TTS</h1> <button class="btn btn-secondary text-sm">Logout</button></div></header> <main class="flex-1 max-w-7xl mx-auto w-full px-4 py-6 space-y-6"><!> <!> <!> <!></main> <!></div>'),Ma=N('<div class="flex items-center justify-center min-h-screen"><p class="text-gray-600">Checking authentication...</p></div>');function ja(e,o){be(o,!0);let t=V(!1),r=V(!1);Ne(()=>{localStorage.getItem("access_token")?I(t,!0):Ke("/login"),I(r,/iPhone|iPad|iPod/.test(navigator.userAgent),!0)});function s(){it.clearToken(),Ke("/login")}var a=Ae(),n=De(a);{var u=f=>{var c=La(),k=x(c),T=x(k),A=g(x(T),2);A.__click=s,b(T),b(k);var P=g(k,2),E=x(P);ya(E,{});var l=g(E,2);Sa(l,{});var m=g(l,2);la(m,{});var F=g(m,2);Ea(F,{}),b(P);var H=g(P,2);{var p=w=>{var M=Ua();R(w,M)};Z(H,w=>{i(r)&&w(p)})}b(c),R(f,c)},d=f=>{var c=Ma();R(f,c)};Z(n,f=>{i(t)?f(u):f(d,!1)})}R(e,a),_e()}$e(["click"]);export{ja as component};
